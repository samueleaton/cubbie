<!DOCTYPE html>
<html>
<head>
  <title>Cubbie</title>
</head>
<body>

<script type="text/javascript">
  const cubbie = require('./index.js');
  const _ = require('lodash');

  const store = cubbie.createStore({
    file: './store.cubbie',
    encryption: {
      secret: 'mr_poopy_butthole'
    }
  });

  window.store = store;

  store.on('STATE_SET', () => {
    console.log('State Set.');
  });

  store.describeState({
    people: cubbie.describe({ types: ['Array', 'Null'] }),
    currentPanel: cubbie.describe({ type: 'String', values: ['HOME', 'IRON'] }),
    animal: {
      info: cubbie.describe({ type: 'Array' })
    },
    currentPerson: {
      name: cubbie.describe({ values: ['Sam'] })
    }
  });

  store.initialState = {
    people: [
      {name: "Sam", age: 25},
      {name: "Jasmine", age: 22},
      {name: "Nick", age: 21}
    ],
    animal: {
      info: [null]
    },
    currentPerson: {name: "Sam", age: 25},
    currentPanel: 'HOME'
  };

  store.on('HELLO', (name, age) => {
    console.log('1: hello ' + name + '. You are ' + age);
  });
  store.on('HELLO', (name, age) => {
    console.log('2: hello ' + name + '. You are ' + age);
  });
  store.once('HELLO', (name, age) => {
    console.log('3: HELLO ' + name + '!!! YOU ARE ' + age + '!!!');
  });
  store.once('HELLO', (name, age) => {
    console.log('4: HELLO ' + name + '!!! YOU ARE ' + age + '!!!');
  });
  store.on('HELLO', (name, age) => {
    console.log('5: hello ' + name + '. You are ' + age);
  });

  store.freeze();

  store.createView('oldestPerson', (state) => {
    return _.maxBy(state.people, person => person.age);
  })
</script>
</body>
</html>
